apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: example-service-rules
  namespace: example-self-hosted-saas-app
  labels:
    release: kube-prom-stack
    k8s-app: example-self-hosted-saas-app
spec:
  groups:
    - name: example.rules
      rules:
        - alert: ExampleServiceDown
          expr: sum_over_time(up{job="example-self-hosted-saas-app"}[10m]) == 0
          labels:
            severity: critical
          annotations:
            summary: "Service example-self-hosted-saas-app is down"
            description: "No successful scrapes for job=example-self-hosted-saas-app during the last 10 minutes."
        - alert: ExampleServiceHttpDown
          expr: sum_over_time(example_app_probe_up{endpoint="http"}[10m]) == 0
          labels:
            severity: critical
          annotations:
            summary: "example-self-hosted-saas-app HTTP endpoint is down"
            description: "No successful probes for endpoint=http in the last 10 minutes."
        - alert: ExampleServiceDBDown
          expr: sum_over_time(example_app_probe_up{endpoint="db"}[10m]) == 0
          labels:
            severity: critical
          annotations:
            summary: "example-self-hosted-saas-app DB dependency is down"
            description: "No successful probes for endpoint=db in the last 10 minutes."
        - alert: ExampleServiceESDown
          expr: sum_over_time(example_app_probe_up{endpoint="es"}[10m]) == 0
          labels:
            severity: critical
          annotations:
            summary: "example-self-hosted-saas-app Elasticsearch dependency is down"
            description: "No successful probes for endpoint=es in the last 10 minutes."
        - alert: ExampleServiceDeploymentUnavailable
          expr: kube_deployment_status_replicas_unavailable{deployment="example-self-hosted-saas-app",namespace="example-self-hosted-saas-app"} > 0
          labels:
            severity: warning
          annotations:
            summary: "example-self-hosted-saas-app deployment has unavailable replicas"
            description: "One or more replicas for the Deployment are unavailable (requires kube-state-metrics to be present)."
        - alert: ExampleServiceFullyDown
          expr: kube_deployment_status_replicas_available{deployment="example-self-hosted-saas-app",namespace="example-self-hosted-saas-app"} == 0
          labels:
            severity: critical
          annotations:
            summary: "example-self-hosted-saas-app deployment fully unavailable"
            description: "All replicas for the Deployment are unavailable (no available replicas). Immediate attention required."
